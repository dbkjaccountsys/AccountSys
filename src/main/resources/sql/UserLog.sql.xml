<?xml version="1.0" encoding="UTF-8" ?>
<sql-statement namespace="com.dbkj.account.model.UserLog">

    <sql id="createTable">
        create table if not exists user_log (like user_log)
    </sql>
    <sql id="add">
        insert into user_log(usertype,userid,time,ip,content,opera_type,opera_result,exception_msg) values(?,?,?,?,?,?,?,?)
    </sql>
    <sql id="getLoginFailTimes">
        select count(1) as times from user_log where opera_type=? and time between ? and ? and opera_result=? limit 0,?
    </sql>
    <sql id="getPage">
        <![CDATA[
            SELECT t2.id,t2.usertype,t2.userid,t1.username,t2.time,t2.ip,t2.content,t4.desc,t2.opera_result,t2.opera_type,t2.exception_msg
            FROM admin t1
            INNER JOIN user_log_${month} t2 ON t1.id=t2.userid
            INNER JOIN
            (
                SELECT id FROM user_log
                WHERE usertype=? AND opera_result=?
                <#if adminList??&&(adminList?size>0)>
                    and userid in
                    (<#list idList as item>${item}<#if item_index!=adminList?size-1>,</#if></#list>)
                </#if>
                <#if startTime??>
                    and time>=?
                </#if>
                <#if endTime??>
                    and time<=?
                </#if>
                <#if operaType??>
                    and opera_type=?
                </#if>
                ORDER BY `time` DESC LIMIT ?,?
            ) t3 ON t2.id=t3.id
            INNER JOIN opera_type t4 ON t2.opera_type=t4.id
        ]]>
    </sql>
    <sql id="getCount">
        <![CDATA[
            SELECT COUNT(1) FROM user_log
            WHERE usertype=? AND opera_result=?
            <#if adminList??&&(adminList?size>0)>
                and userid in
                (<#list idList as item>${item}<#if item_index!=adminList?size-1>,</#if></#list>)
            </#if>
            <#if startTime??>
                and time>=?
            </#if>
            <#if endTime??>
                and time<=?
            </#if>
            <#if operaType??>
                and opera_type=?
            </#if>
        ]]>
    </sql>
</sql-statement>